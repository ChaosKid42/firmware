--- net/ipv4/udp.c.orig	2010-10-19 13:11:35.858689919 +0200
+++ net/ipv4/udp.c	2010-10-19 13:14:19.796734107 +0200
@@ -711,7 +711,14 @@
 	skb = skb_recv_datagram(sk, flags, noblock, &err);
 	if (!skb)
 		goto out;
-  
+
+	if (skb->nh.iph->version != 4) {
+		skb_free_datagram(sk, skb);
+		if (noblock)
+			return -EAGAIN;
+		goto try_again;
+	}
+
   	copied = skb->len - sizeof(struct udphdr);
 	if (copied > len) {
 		copied = len;
