--- a/net/ipv4/udp.c	2011-03-23 08:35:44.292729798 +0100
+++ b/net/ipv4/udp.c	2011-03-23 08:40:09.913605183 +0100
@@ -711,8 +711,15 @@
 	skb = skb_recv_datagram(sk, flags, noblock, &err);
 	if (!skb)
 		goto out;
-  
-  	copied = skb->len - sizeof(struct udphdr);
+
+	if (skb->nh.iph->version != 4) {
+		skb_free_datagram(sk, skb);
+		if (noblock)
+			return -EAGAIN;
+		goto try_again;
+	}
+
+	copied = skb->len - sizeof(struct udphdr);
 	if (copied > len) {
 		copied = len;
 		msg->msg_flags |= MSG_TRUNC;
